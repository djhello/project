"use strict";var __decorate=this&&this.__decorate||function(e,t,i,s){var r,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,s);else for(var n=e.length-1;0<=n;n--)(r=e[n])&&(o=(a<3?r(o):3<a?r(t,i,o):r(t,i))||o);return 3<a&&o&&Object.defineProperty(t,i,o),o},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),forms_1=require("@angular/forms"),router_1=require("@angular/router"),platform_browser_1=require("@angular/platform-browser"),service_1=require("../../../shared/service"),IssueComponent=function(){function e(e,t,i,s){this.router=e,this.titleService=t,this.formBuilder=i,this._dataService=s,this.equipmentsList=[],this.availableEquipmentList=[],this.availableEquipmentListCopy=[],this.equipmentChoosed=[],this.equipmentIssueedList=[],this.equipmentByUserIssueedList=[],this.loading=!1,this.showSearchMemberDiv=!1,this._getUrl="/api/circulation/getissueall",this._getbyIdUrl="/api/circulation/getissuebyid",this._saveUrl="/api/circulation/issueequipment",this._getEquipmentUrl="/api/circulation/getallequipment",this._getAvailableallEquipmentUrl="/api/equipment/getavailableallequipment",this._getbyUserIdUrl="/api/users/getbyid",this.loggedUser=JSON.parse(localStorage.getItem("loggedUser"))}return e.prototype.handleKeyboardEvent=function(e){this.keyPress=e.keyCode,32==this.keyPress&&(this.resMessage=null,this.reset(),this.focus())},e.prototype.ngOnInit=function(){this.titleService.setTitle("Envanter Takip Sistemi| Ödünç"),this.loadScripts(),this.createForm(),this.getAvailableEquipmentList(),this.setUser()},e.prototype.loadScripts=function(){for(var e=["assets/js/datepicker-init.js"],t=0;t<e.length;t++){var i=document.createElement("script");i.src=e[t],i.type="text/javascript",i.async=!1,i.charset="utf-8",document.getElementsByTagName("body")[0].appendChild(i)}},e.prototype.createForm=function(){this.issueForm=this.formBuilder.group({id:0,userId:new forms_1.FormControl("",forms_1.Validators.required),memberSearch:new forms_1.FormControl(""),memberName:new forms_1.FormControl(""),email:new forms_1.FormControl("",forms_1.Validators.required),dueDate:new forms_1.FormControl("",forms_1.Validators.required),equipments:[]}),this.focus()},e.prototype.setUser=function(){var e;console.log(this.loggedUser),1!=this.loggedUser.userType?(this.showSearchMemberDiv=!1,(e=new Date).setDate(e.getDate()+15),this.issueForm.setValue({id:0,userId:this.loggedUser.userId,memberName:this.loggedUser.displayName,email:this.loggedUser.email,dueDate:e.toLocaleDateString("en-US"),memberSearch:null,equipments:[]})):this.showSearchMemberDiv=!0},e.prototype.onChange=function(e,t){var i=this;this.loading=!0,this.reset(),e.preventDefault(),this._dataService.getbyid(t,this._getbyUserIdUrl).subscribe(function(e){i.user=e;e=new Date;e.setDate(e.getDate()+15),i.issueForm.setValue({id:0,userId:i.user.userId,memberName:i.user.firstName+" "+i.user.lastName,email:i.user.email,dueDate:e.toLocaleDateString("en-US"),memberSearch:null,equipments:[]})},function(e){}),this._dataService.getbyid(t,this._getbyIdUrl).subscribe(function(e){i.loading=!1,null!=e&&(i.equipmentByUserIssueedList=e),i.resMessage=null},function(e){})},e.prototype.onSearch=function(){var t=this.searchTerm;this.availableEquipmentList=this.availableEquipmentListCopy.filter(function(e){return 0<=e.equipmentId.toLowerCase().indexOf(t.toLowerCase())})},e.prototype.oncheckChange=function(e,t){e.preventDefault(),e.currentTarget.checked?this.equipmentChoosed.push({id:t}):this.removeArrayList(this.equipmentChoosed,t)},e.prototype.removeArrayList=function(i,s){return i.forEach(function(e,t){e.id==s&&i.splice(t,1)}),i},e.prototype.onSubmit=function(){var t=this;this.loading=!0,this.issueForm.patchValue({equipments:this.equipmentChoosed}),this.issueForm.invalid||(0!=this.issueForm.value.equipments.length?0<this.issueForm.value.userId&&this._dataService.saveWithUser(this.issueForm.value,this.loggedUser,this._saveUrl).subscribe(function(e){t.loading=!1,t.resMessage=e.message,t.alertMessage="alert-outline-info",t.reset(),t.focus()},function(e){}):(this.loading=!1,alert("Lütfen en az bir ekipmanı seçiniz")))},e.prototype.equipmentList=function(){var t=this;this.loading=!0,this._dataService.getall(this._getEquipmentUrl).subscribe(function(e){t.loading=!1,t.equipmentsList=e},function(e){})},e.prototype.getAvailableEquipmentList=function(){var t=this;this.loading=!0,this._dataService.getall(this._getAvailableallEquipmentUrl).subscribe(function(e){t.loading=!1,t.availableEquipmentList=e,t.availableEquipmentListCopy=e},function(e){})},e.prototype.issueedList=function(){var t=this;this.loading=!0,$("#largesizemodal").modal({backdrop:"static",keyboard:!1,show:!0}),this._dataService.getall(this._getUrl).subscribe(function(e){t.loading=!1,t.equipmentIssueedList=e},function(e){})},e.prototype.issueedListclose=function(){this.focus()},e.prototype.reset=function(){1==this.loggedUser.userType&&this.issueForm.setValue({id:0,userId:0,memberSearch:null,memberName:null,email:null,dueDate:null,equipments:[]}),this.searchTerm="",this.availableEquipmentList=[],this.availableEquipmentListCopy=[],this.getAvailableEquipmentList(),this.equipmentByUserIssueedList=[],this.equipmentChoosed=[]},e.prototype.focus=function(){$("#memberSearch").focus()},__decorate([core_1.HostListener("document:keypress",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[KeyboardEvent]),__metadata("design:returntype",void 0)],e.prototype,"handleKeyboardEvent",null),__decorate([core_1.Component({selector:"ng-issue",templateUrl:"./app/backoffice/circulation/issue/component.html",providers:[service_1.DataService]}),__metadata("design:paramtypes",[router_1.Router,platform_browser_1.Title,forms_1.FormBuilder,service_1.DataService])],e)}();exports.IssueComponent=IssueComponent;