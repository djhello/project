"use strict";var __decorate=this&&this.__decorate||function(e,t,r,s){var o,i=arguments.length,a=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,s);else for(var l=e.length-1;0<=l;l--)(o=e[l])&&(a=(i<3?o(a):3<i?o(t,r,a):o(t,r))||a);return 3<i&&a&&Object.defineProperty(t,r,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),forms_1=require("@angular/forms"),router_1=require("@angular/router"),platform_browser_1=require("@angular/platform-browser"),service_1=require("../../../shared/service"),UsersComponent=function(){function e(e,t,r,s){this.router=e,this.titleService=t,this.formBuilder=r,this._dataService=s,this.loading=!1,this._getUrl="/api/users/getall",this._getbyIdUrl="/api/users/getbyid",this._saveUrl="/api/users/save",this._deleteUrl="/api/users/deletebyid";s=JSON.parse(localStorage.getItem("loggedUser"));this.loggedUsername=s.displayname,this.loggedemail=s.email,this.loggedUsertype=s.usertype}return e.prototype.ngOnInit=function(){this.titleService.setTitle("Envanter Takip Sistemi | KullancÄ±lar"),this.createForm(),this.getAll()},e.prototype.userTypeControl=function(){1!=this.loggedUsertype&&(localStorage.removeItem("isLoggedin"),localStorage.removeItem("loggedUser"),this.router.navigate(["/login"]))},e.prototype.createForm=function(){this.userForm=this.formBuilder.group({userId:0,firstName:new forms_1.FormControl("",forms_1.Validators.required),lastName:new forms_1.FormControl("",forms_1.Validators.required),email:new forms_1.FormControl("",forms_1.Validators.compose([forms_1.Validators.required,forms_1.Validators.pattern("^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+.[a-zA-Z0-9-.]+$")]))}),$("#firstName").focus()},e.prototype.addNew=function(){$("#defaultsizemodal").modal("show"),$("#defaultsizemodal").on("shown.bs.modal",function(){$(this).find("#firstName").focus()}),this.reset()},e.prototype.getAll=function(){var t=this;this.loading=!0,this._dataService.getall(this._getUrl).subscribe(function(e){t.loading=!1,t.users=e},function(e){console.log(e)})},e.prototype.edit=function(e,t){var r=this;this.loading=!0,e.preventDefault(),this._dataService.getbyid(t.userId,this._getbyIdUrl).subscribe(function(e){r.loading=!1,r.user=e,r.userForm.setValue({userId:r.user.userId,firstName:r.user.firstname,lastName:r.user.lastname,email:r.user.email}),$("#defaultsizemodal").modal("show"),$("#defaultsizemodal").on("shown.bs.modal",function(){$(this).find("#firstName").focus()})},function(e){})},e.prototype.onSubmit=function(){var t=this;this.loading=!0,this.userForm.invalid||this._dataService.save(this.userForm.value,this._saveUrl).subscribe(function(e){t.resmessage=e.message,t.alertmessage="alert-outline-info",t.getAll(),t.reset(),t.loading=!1},function(e){})},e.prototype.delete=function(e,t){var r=this;this.loading=!0,e.preventDefault(),confirm("You are about to delete "+t.firstname+". Are you sure?")&&this._dataService.delete(t.userId,this._deleteUrl).subscribe(function(e){r.loading=!1,r.resmessage=e,r.getAll()},function(e){})},e.prototype.reset=function(){this.userForm.setValue({userId:0,firstName:null,lastName:null,email:null}),this.resmessage=null,$("#firstName").focus()},__decorate([core_1.Component({selector:"ng-users",templateUrl:"./app/backoffice/system/users/component.html",providers:[service_1.DataService]}),__metadata("design:paramtypes",[router_1.Router,platform_browser_1.Title,forms_1.FormBuilder,service_1.DataService])],e)}();exports.UsersComponent=UsersComponent;